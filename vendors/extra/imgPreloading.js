define(["jquery","extra/Class","modernizr"],function(e,t){var n=t.extend({init:function(t){this.$element=e(t)}}),r=navigator.userAgent,i=r.indexOf("Android")>-1;return n.preload=function(t){n.options=t?t:{},n.items=e(".imgdiv"),n.loadcount=0,n.totalcount=n.items.length,n.totalcount==0&&n._complete(),n.items.each(function(e,t){(new n(t))._load()})},n._complete=function(){++n.loadcount,(n.loadcount==0||n.loadcount==n.totalcount&&n.options.onComplete)&&n.options.onComplete()},n.prototype._load=function(){var t=this;t._source=t.$element.attr("data-source"),t._type=t.$element.attr("data-type"),t._texture=e("<img>").one("load",function(){t._texture=this,t._render()}).on("error",function(){n._complete(),n.options.onError&&n.options.onError()}).attr("src",t._source)[0]},n.prototype._render=function(){var t=this;t._type=="bg"?t.$element.css({"background-image":"url("+t._source+")"}):Modernizr.canvas&&!i&&t._source.indexOf(".gif")==-1?(t._mycs=e('<canvas width="'+t._texture.width+'" height="'+t._texture.height+'">').appendTo(t.$element),t._ctx=t._mycs[0].getContext("2d"),t._ctx.drawImage(t._texture,0,0,t._texture.width,t._texture.height)):t._mycs=e('<img src="'+t._source+'" alt="">').appendTo(t.$element),n._complete(),n.options.onLoad&&n.options.onLoad(n.loadcount,n.totalcount,t._source)},n});